# OpenCore Initializer 项目架构设计

## 项目概述

OpenCore Initializer 是一个类似于 Spring Boot Initializer 的 Web 应用，用于生成和配置 OpenCore 引导加载器。该项目采用现代化的前端技术栈，支持多语言、文件生成和打包功能，并可部署到 Cloudflare Workers。

## 技术栈选择

### 前端框架
- **React 18+**: 使用最新的 React 版本，支持并发特性和现代化开发体验
- **TypeScript**: 提供类型安全和更好的开发体验
- **Vite**: 快速的构建工具，支持热重载和优化的生产构建

### UI 框架和样式
- **Tailwind CSS**: 实用优先的 CSS 框架，快速构建现代化界面
- **Headless UI**: 无样式的可访问组件库
- **Lucide React**: 现代化的图标库

### 状态管理
- **Zustand**: 轻量级状态管理库，适合中小型应用
- **React Hook Form**: 高性能的表单处理库

### 国际化
- **react-i18next**: React 的国际化解决方案
- **i18next**: 强大的国际化框架

### 文件处理
- **JSZip**: 在浏览器中生成 ZIP 文件
- **FileSaver.js**: 文件下载功能
- **js-yaml**: YAML 文件处理

### 部署和构建
- **Cloudflare Workers**: 边缘计算平台，支持全球部署
- **Wrangler**: Cloudflare Workers 的开发工具

## 项目结构

```
OpenCoreInitializr/
├── docs/                    # 项目文档
│   ├── architecture.md     # 架构设计文档
│   ├── api.md              # API 设计文档
│   └── deployment.md       # 部署指南
├── public/                  # 静态资源
│   ├── locales/            # 多语言文件
│   │   ├── en/            # 英文翻译
│   │   ├── zh-CN/         # 简体中文翻译
│   │   └── zh-TW/         # 繁体中文翻译
│   ├── templates/          # OpenCore 模板文件
│   ├── docs/              # 配置参数文档
│   │   ├── parameters/    # 参数说明文档
│   │   └── guides/        # 使用指南
│   └── data/              # 静态数据文件
│       ├── versions.json  # 版本信息数据
│       └── compatibility.json # 兼容性数据
├── src/
│   ├── components/         # React 组件
│   │   ├── ui/            # 基础 UI 组件
│   │   ├── forms/         # 表单组件
│   │   ├── layout/        # 布局组件
│   │   ├── version/       # 版本管理组件
│   │   └── help/          # 帮助和文档组件
│   ├── hooks/             # 自定义 Hooks
│   ├── lib/               # 工具库
│   │   ├── opencore/      # OpenCore 配置生成逻辑
│   │   ├── packaging/     # 文件打包功能
│   │   ├── version/       # 版本管理功能
│   │   └── utils/         # 通用工具函数
│   ├── stores/            # 状态管理
│   ├── types/             # TypeScript 类型定义
│   ├── i18n/              # 国际化配置
│   ├── pages/             # 页面组件
│   │   ├── ConfigWizard.tsx    # 配置向导页面
│   │   ├── VersionTracker.tsx  # 版本追踪页面
│   │   └── Documentation.tsx   # 文档页面
│   └── App.tsx            # 主应用组件
├── wrangler.toml           # Cloudflare Workers 配置
├── package.json
├── vite.config.ts
└── tailwind.config.js
```

## 核心功能模块

### 1. 配置表单模块
- **硬件配置**: CPU、主板、显卡等硬件信息选择
- **引导选项**: OpenCore 版本、引导参数配置
- **驱动管理**: Kext 驱动选择和配置
- **ACPI 补丁**: SSDT 和 DSDT 补丁配置
- **参数解析**: 每个配置参数的详细说明和多语言解释

### 2. 版本管理模块
- **OpenCore 版本追踪**: 实时获取和展示 OpenCore 最新版本信息
- **Kext 版本管理**: 常见 Kext 驱动的版本信息和更新状态
- **兼容性检查**: 不同版本间的兼容性验证
- **更新通知**: 新版本发布时的提醒功能

### 3. 配置生成模块
- **config.plist 生成**: 根据用户选择生成 OpenCore 配置文件
- **EFI 结构生成**: 创建完整的 EFI 文件夹结构
- **驱动文件管理**: 自动包含所需的 Kext 驱动

### 4. 确认和预览模块
- **配置摘要**: 显示用户选择的完整配置信息
- **下载清单**: 列出将要下载的所有文件和组件
- **文件说明**: 每个文件的用途和重要性说明
- **兼容性检查**: 最终的兼容性验证和警告提示
- **用户确认**: 确认界面，用户可以修改或确认配置

### 5. 文件下载和打包模块
- **分步下载**: 按需下载 OpenCore、Kexts 和 ACPI 文件
- **下载进度**: 实时显示下载进度和状态
- **文件验证**: 验证下载文件的完整性和签名
- **ZIP 打包**: 所有文件下载完成后生成 ZIP 压缩包
- **ISO 生成**: 创建可引导的 ISO 镜像文件
- **错误处理**: 下载失败时的重试和错误提示机制

### 6. 多语言支持
- **动态语言切换**: 支持中文、英文等多种语言
- **本地化内容**: 界面文本、帮助信息的本地化
- **参数文档国际化**: 配置参数说明的多语言支持
- **RTL 支持**: 为阿拉伯语等语言提供从右到左的布局支持

### 7. 帮助和文档模块
- **配置参数解释**: 每个 OpenCore 配置项的详细说明
- **硬件兼容性指南**: 不同硬件的配置建议
- **故障排除指南**: 常见问题的解决方案
- **最佳实践文档**: OpenCore 配置的最佳实践建议

## 数据流架构

```
用户界面 (React Components)
    ↓
状态管理 (Zustand Store)
    ↓
配置生成器 (OpenCore Generator)
    ↓
配置确认页面 (Configuration Summary)
    ↓
文件下载管理器 (Download Manager)
    ↓
文件验证器 (File Validator)
    ↓
文件打包器 (Packaging Service)
    ↓
文件下载 (FileSaver)
```

### 详细流程说明

1. **配置阶段**: 用户通过表单界面选择硬件配置和 OpenCore 选项
2. **生成阶段**: 系统根据用户选择生成配置文件和所需文件清单
3. **确认阶段**: 显示配置摘要和下载清单，用户确认后进入下载阶段
4. **下载阶段**: 分步下载所需的 OpenCore、Kexts 和 ACPI 文件
5. **验证阶段**: 验证所有下载文件的完整性和兼容性
6. **打包阶段**: 将所有文件打包成 ZIP 或 ISO 格式
7. **完成阶段**: 提供最终文件的下载链接

## 部署架构

### Cloudflare Workers 部署
- **静态资源**: 通过 Cloudflare Pages 托管
- **边缘计算**: 利用 Workers 进行文件生成和处理
- **全球 CDN**: 确保全球用户的访问速度

### 本地开发环境
- **开发服务器**: Vite 开发服务器，支持热重载
- **类型检查**: TypeScript 编译时类型检查
- **代码质量**: ESLint 和 Prettier 代码规范

## 性能优化策略

### 1. 代码分割
- **路由级分割**: 按页面进行代码分割
- **组件级分割**: 大型组件的懒加载
- **第三方库分割**: 将大型依赖库单独打包

### 2. 资源优化
- **图片优化**: 使用 WebP 格式和响应式图片
- **字体优化**: 字体子集化和预加载
- **缓存策略**: 合理的浏览器缓存配置

### 3. 运行时优化
- **虚拟滚动**: 大列表的性能优化
- **防抖和节流**: 用户输入的性能优化
- **内存管理**: 避免内存泄漏和不必要的重渲染

## 安全考虑

### 1. 客户端安全
- **输入验证**: 严格的表单输入验证
- **XSS 防护**: 防止跨站脚本攻击
- **内容安全策略**: CSP 头部配置

### 2. 文件安全
- **文件类型验证**: 确保生成文件的安全性
- **大小限制**: 防止生成过大的文件
- **恶意代码检测**: 基础的安全扫描

## 可扩展性设计

### 1. 插件系统
- **模板扩展**: 支持自定义 OpenCore 模板
- **驱动扩展**: 动态加载新的 Kext 驱动
- **主题扩展**: 支持自定义 UI 主题

### 2. API 设计
- **RESTful API**: 标准的 API 接口设计
- **版本控制**: API 版本管理策略
- **文档生成**: 自动化 API 文档生成

## 测试策略

### 1. 单元测试
- **组件测试**: React 组件的单元测试
- **工具函数测试**: 核心逻辑的单元测试
- **覆盖率要求**: 80% 以上的代码覆盖率

### 2. 集成测试
- **端到端测试**: 完整用户流程的测试
- **跨浏览器测试**: 主流浏览器的兼容性测试
- **性能测试**: 页面加载和交互性能测试

## 开发流程

### 1. 开发环境设置
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 类型检查
npm run type-check

# 代码格式化
npm run format
```

### 2. 构建和部署
```bash
# 构建生产版本
npm run build

# 预览构建结果
npm run preview

# 部署到 Cloudflare Workers
npm run deploy
```

## 总结

本架构设计基于现代化的前端技术栈，充分考虑了性能、安全性、可扩展性和用户体验。通过模块化的设计和清晰的数据流，确保项目的可维护性和可扩展性。同时，支持 Cloudflare Workers 部署，提供全球化的服务能力。